<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Positive Balance</title>
    <style media="screen">
        input[type=text]:invalid {
            background: yellow;
        }

        input[type=number]:invalid {
            background: yellow;
        }

        form {
            /* Just to center the form on the page */
            margin: 0 auto;
            width: 400px;
            /* To see the outline of the form */
            padding: 1em;
            border: 1px solid #CCC;
            border-radius: 2em;
        }

        form div+div {
            margin-top: 1em;
        }

        form.dropDown {
            border: 0px;
            margin: auto;
        }
        form.template{
            border: none;
            width: 80%;
        }

        label {
            /* To make sure that all labels have the same size and are properly aligned */
        }

        input,
        textarea {
            /*To make sure that all text fields have the same font settings. By default, testareas have a monospace font*/
            font: 1 em sans-serif;
            /*To give the same size to all text field*/
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            /* To harmonize the look and feel of text filed border */
            border: 1px solid #999
        }

        div.title {
            width: 150px;
            text-align: left;
            font: 1 em sans-serif;
            font-weight: bold;
        }

        div.inputs {
            display: inline-block;
            text-align: left;
        }

        #balance {
            text-align: right;
            width: 150px;
            text-align: left;
            font: 1 em sans-serif;
            font-weight: bold;
        }

        .input {
            align-items: center;
        }

        div.showOnYep {
            display: none;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script name="activities_array" type="text/javascript">
        // "database"
        var activities = [{
            minQty: 1,
            moreorless: 1,
            name: "run",
            unitName: "mile",
            weight: 6
        }];
    </script>
    <script name="new_update_summary_functions">
        // populate Update Section with activity_name, didIdo, howManyUnits and button for each element in activities array
        function updateView() {
            $('#dropDown').empty();
            activities.forEach(function(element) {
                var template =
                    '<form class="template">'+
                    '<div id="' + element.name + '">' +
                    '<span class="dropDown">' +
                    '<p>' + 'Did you ' + '<span>' + element.name + '</span>' + '?  ' +

                    '<label for="yep">' + 'Yep:' + '</label>' +
                    '<input class="' + element.name + 'yep " type="radio" name="didIDo" id="yep"> ' +
                    '<label for="nope">' + 'Nope:' + '</label>' +
                    '<input class= "yepnope" type="radio" name="didIDo" id="nope">' + '</p>' +

                    '<div class="' + element.name + 'showOnYep ">' +
                    '<label for="howManyUnits">' + 'How many times did you ' +
                    element.name + ' ' + element.minQty + ' ' + element.unitName +
                    '?</label>' +
                    '<input id="howManyUnits-' +
                    element.name + '" type="number" class="howManyUnits" name="howManyUnits" placeholder="1, 10..." />' +
                    '<button type="button" name="button" onclick="updateActivity(' + element.name + ')">' + 'Update ' + element.name + '</button>' +
                    '</span>' +
                    '</div>' +
                    '</div>' +
                    '</form>';



                $('#dropDown').append(template);
                document.getElementById('howManyUnits-' + element.name).addEventListener('keypress', function(event) {
                    if (event.keyCode == 13) {
                        event.preventDefault();
                        add2Props(element.name);
                    }
                });

                $('.' + element.name + 'showOnYep').css({
                    display: "none"
                });

                $('#' + element.name).find('.' + element.name + 'yep').focusin(function() {
                    $('.' + element.name + 'showOnYep').slideToggle();
                });

            });

        };

        // update views on initial page load
        $(document).ready(function() {
            updateView();
            updateSummaryView();
            updateFinalNumView();
        });

        // on update click:
        function updateActivity(arg) {
            // modify didIDo and howManyUnits properties on activity objects
            var activity_name = arg.id;
            var elementNameConcat = '#' + arg.id;
            var howManyUnits = $(elementNameConcat).find('.howManyUnits').val();
            var didIDo;
            if ($(elementNameConcat).find('.yep:checked').val()) {
                didIDo = 'yep';
            } else {
                didIDo = 'nope';
            };

            var actConst = {
                name: activity_name,
                didIDo: didIDo,
                howManyUnits: howManyUnits
            };

            // once all values are stored, update the correct activity in our main activties array
            activities = activities.map(function(element) {
                if (element.name === actConst.name) {
                    element.howManyUnits = actConst.howManyUnits;
                    element.didIDo = actConst.didIDo;
                }
                return element;
            })
            console.log("activities:", activities);
            updateSummaryView();
            updateFinalNumView();
        }

        // create new activity object in activities array and refresh Update Section
        function createNew() {
            var activity_name = $('#activityName').val();
            var moreorless;
            if ($('#more:checked').val()) {
                moreorless = 1;
            } else {
                moreorless = -1;
            };
            var unitName = $('#activityUnit').val();
            var minQty = $('#min_qty').val();
            var weight = $('#activity_weight').val();

            var actConst = {
                name: activity_name,
                unitName: unitName,
                minQty: minQty,
                moreorless: moreorless,
                weight: weight
            };

            var potentialElement = activities.filter(function(element) {
                return element.name === actConst.name;
            });

            if (potentialElement.length === 0) {
                activities.push(actConst);
                // $('#dropDown').append(template);
                // console.log("After push(createNew):", activities);
                return;
            } else {
                activities = activities.map(function(element) {
                    if (element.name === actConst.name) {
                        element = actConst;
                    }
                    return element;
                })
            };
            updateView();
        }

        // dynamically update activty name in Create New Activity section
        function blurFunc() {
            document.getElementById('doSpan').innerHTML = $('#activityName').val();
        };

        // summarize certain properties of each activity
        function updateSummaryView() {
            $('#summary').empty();
            activities.forEach(function(element) {
                var unitTotal = (element.moreorless * (element.howManyUnits * element.minQty) * element.weight);
                var template =
                    // if didIDo = “yep”, then display “activityName + (howManyUnits * minQty = total) + unitName”
                    '<div id="' + element.name + '-summary' + '">' +
                    '<ul>' +
                    // '<li>' +element.name+ ': ' +unitTotal+ ' ' +element.unitName+ '</li>'+
                    '<li>' + element.name + ': ' + unitTotal + '</li>' +
                    '</ul>' +
                    '</div>';
                $('#summary').append(template);
            });
        };

        function finalNum() {
            return activities.reduce(function(acc, element) {
                var unitTotal = (element.moreorless * (element.howManyUnits * element.minQty) * element.weight);
                return unitTotal + acc;
            }, 0)
        }

        function updateFinalNumView() {
            $('#finalNum').empty();
            var template =
                '<div class="title" id="finalNum">' +
                '<p>' + 'Balance: ' + '<span id="balance">' + finalNum() + '</span>' + '</p>' +
                '</div>';
            $('#finalNum').append(template);
        };
    </script>

</head>

<body>

    <form id="new">
        <div class="title">
            <p>Create new activity</p>
        </div>
        <div>
            <div class="input">
                <p>I would like to</p>
            </div>
            <div class="input">
                <label for="activity_name"></label>
                <input type="text" id="activityName" name="activity_name" placeholder="run, drink, meditate..." onblur="blurFunc()" />
            </div>
            <div class="input">
                <label for="more">more</label>
                <input type="radio" value="+1" id="more" name="moreorless">

                <label for="less">less</label>
                <input type="radio" value="-1" id="less" name="moreorless">
            </div>

            <div class="input">
                <label for="activity_unit">
                    <p>The smallest amount I might <span id="doSpan"></span> is</p>
                </label>

                <label for="min_qty"></label>
                <input type="number" id="min_qty" size="10" name="min_qty" placeholder="1, 10..." />

                <input type="text" id="activityUnit" name="activity_unit" placeholder="miles, drink, minutes..." />
            </div>

            <div class="input">
                <label for="activity_weight">How important is this to you? (10 is most important)</label>
                <input type="number" id="activity_weight" name="activity_weight" min="1" max="10" placeholder="1-10" />
            </div>
        </div>

        <div class="button">
            <button type="button" onclick="createNew()">Save</button>
        </div>
    </form>

    <form id="update">
        <div class="title">
            <p>Activity Update</p>
        </div>
        <div>
            <label for="dropDown"></label>
            <ul id="dropDown" name="dropDown">
            </ul>
        </div>
    </form>

    <form id="summary">
        <div class="title">
            <p>Summary</p>
        </div>
        <div>
            <label for="summarySection"></label>
            <ul id="summarySection">
            </ul>
        </div>

    </form>

    <form id="finalNum">
        <div class="title">

            <!-- <span></span> -->
        </div>
    </form>

</body>

</html>
